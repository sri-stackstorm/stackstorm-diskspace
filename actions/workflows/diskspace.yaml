# This is a sample action file generated by Stackstorm VSCode Extension, Change as required.
version: 1.0
description: workflow for cleaning up /var
# input: {}
vars:
   - stdout: null
   - stderr: null
   - host: "40.122.212.105"
   - cmd: "df -h /var"
   - slack1: "T01CZJRGW4X/B01DNTP6PHQ"
   - slack2: "VKYMvy8KCHMlVj3Rpqd2pHZV"
   - slack: https://hooks.slack.com/services/<% ctx().slack1 %>/<% ctx().slack2 %>
tasks:
   sending_notifications:
      action: slack.post_message
      input:
         message: "Recevied var filesystem alert kicking of self healing"
         webhook_url: <% ctx(slack) %>
         username: "slackautomation"
      next:
         - when: '{{ succeeded() }}'
           do:
             - check_dir_size
   check_dir_size:
      action: core.remote_sudo
      input:
         hosts: <% ctx(host) %>
         cmd: <% ctx(cmd) %>
         username: stockstorm
         password: admin123
      next:
         - when: '{{ succeeded() }}'
           publish: stdout= <% result().stdout %>
         - when: '{{ failed() }}'
           publish: stderr=<% result().stderr %>

output:
   - stdout: <% ctx(stdout) %>
   - stderr: <% ctx(stderr) %>
