# This is a sample action file generated by Stackstorm VSCode Extension, Change as required.
version: 1.0
description: workflow for cleaning up /var
input: {}
vars:
   - stdout: null
   - stdout: null
   - host: "40.122.212.105"
   - cmd: "df -h /var"
tasks:
   sending_notifications:
      action: slack.post_message
      input:
         - message: "Recevied var filesystem alert kicking of self healing"
         - webhook_url: "https://hooks.slack.com/services/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"
         - username: "slackautomation"
      next:
         - when: '{{ succeeded() }}'
           do:
             - check_dir_size
         - when: '{{ failed() }}'
           do:
             - sending_notifications
   check_dir_size:
      action: core.remote_sudo host=<% ctx(host) %> cmd= <% ctx(cmd) %>
      next:
         - when: <% succeeded() %>
           publish: stdout= <% result().stdout %>
         - when: <% failed() %>
           publish: stderr=<% result().stderr %>

output:
   - stdout: <% ctx(stdout) %>
   - stderr: <% ctx(stderr) %>
